###
# SIM800L SMS Manager API Test Suite
# REST Client tests for all API endpoints
# 
# Usage: Open in VS Code with REST Client extension
# Click "Send Request" above each request to execute
###

@baseUrl = http://192.168.1.65:8000
@contentType = application/json

###
# Test 1: Get API Status
# Check if SMS Manager is connected and listening
GET {{baseUrl}}/status
Accept: application/json

###
# Test 2: Get API Documentation (HTML)
# View the main documentation page
GET {{baseUrl}}/
Accept: text/html

###
# Test 3: Send Test SMS
# Replace phone number with actual test number
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Test SMS from API - REST Client Test"
}

###
# Test 4: Send SMS with Timestamp
# SMS with current timestamp for tracking
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893", 
  "message": "API Test - {{$datetime iso8601}}"
}

###
# Test 5: Send SMS with Special Characters
# Test SMS with emojis and special characters
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "ðŸ“± SMS API Test with Ã©mojis & spÃ«cial chars! ðŸš€"
}

###
# Test 6: Send Long Message
# Test SMS with message close to 160 character limit
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "This is a long SMS message to test the 160 character limit handling. It should be sent successfully even though it's quite lengthy. SMS test!"
}

###
# Test 7: Send SMS with Invalid Phone Number (Error Test)
# This should return an error
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "invalid",
  "message": "This should fail"
}

###
# Test 8: Send SMS with Empty Message (Error Test)
# Test validation with empty message
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": ""
}

###
# Test 9: Get Received Messages
# Retrieve all received SMS messages from queue
GET {{baseUrl}}/messages
Accept: application/json

###
# Test 10: Stop SMS Listening
# Stop the background SMS listener
POST {{baseUrl}}/stop-listening
Content-Type: {{contentType}}

###
# Test 11: Check Status After Stop
# Verify listening status is false
GET {{baseUrl}}/status
Accept: application/json

###
# Test 12: Start SMS Listening
# Restart the background SMS listener
POST {{baseUrl}}/start-listening
Content-Type: {{contentType}}

###
# Test 13: Check Status After Start
# Verify listening status is true
GET {{baseUrl}}/status
Accept: application/json

###
# Test 14: Send Multiple SMS (Bulk Test)
# Send multiple SMS messages in sequence
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Bulk Test 1/3"
}

###
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Bulk Test 2/3"
}

###
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Bulk Test 3/3"
}

###
# Test 15: Send SMS with JSON Special Characters
# Test message with JSON-sensitive characters
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "JSON Test: \"quotes\", \\backslashes\\ and {\"nested\": \"objects\"}"
}

###
# Test 16: Check API Health (Alternative Status)
# Alternative way to check API health
GET {{baseUrl}}/status
Accept: application/json

###
# Test 17: Get Messages After Tests
# Check if any messages were received during testing
GET {{baseUrl}}/messages
Accept: application/json

###
# Test 18: Send SMS with Line Breaks
# Test multi-line message
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Multi-line test:\nLine 1\nLine 2\nLine 3"
}

###
# Test 19: Send SMS with Different Phone Format
# Test with different phone number format
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "264816828893",
  "message": "Phone format test (without +)"
}

###
# Test 20: Performance Test - Quick Succession
# Send messages in quick succession
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Performance Test A"
}

###
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "Performance Test B"
}

###
# Test 21: Final Status Check
# Final verification of API status
GET {{baseUrl}}/status
Accept: application/json

###
# Test 22: Final Message Retrieval
# Get all messages accumulated during test session
GET {{baseUrl}}/messages
Accept: application/json

###
# INTERACTIVE TESTS
# These require manual SMS sending to test receiving functionality

###
# Interactive Test 1: Send an SMS to the SIM card number
# Manually send an SMS from another phone to test receiving
# Then run the following request to check received messages:

# GET {{baseUrl}}/messages

###
# Interactive Test 2: Monitor for Real-time Reception
# Send an SMS and immediately check for it
# Run this multiple times to see new messages appear:

# GET {{baseUrl}}/messages

###
# LOAD TESTING (Uncomment to use)
# Warning: These send many SMS messages - use carefully!

# ### Load Test 1: Send 5 SMS in sequence
# @loop = 5
# POST {{baseUrl}}/send
# Content-Type: {{contentType}}

# {
#   "phone_number": "+264816828893",
#   "message": "Load Test Message {{$randomInt 1 100}}"
# }

###
# ERROR HANDLING TESTS

###
# Error Test 1: Invalid JSON
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "invalid_json": this is not valid json
}

###
# Error Test 2: Missing Required Fields
POST {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893"
}

###
# Error Test 3: Wrong Content Type
POST {{baseUrl}}/send
Content-Type: text/plain

phone_number=+264816828893&message=Wrong content type test

###
# Error Test 4: Invalid HTTP Method
PUT {{baseUrl}}/send
Content-Type: {{contentType}}

{
  "phone_number": "+264816828893",
  "message": "PUT method should not be allowed"
}

###
# Error Test 5: Non-existent Endpoint
GET {{baseUrl}}/invalid-endpoint
Accept: application/json

###
# DOCUMENTATION ENDPOINTS

###
# OpenAPI Schema
GET {{baseUrl}}/openapi.json
Accept: application/json

###
# Swagger UI Documentation
GET {{baseUrl}}/docs
Accept: text/html

###
# ReDoc Documentation  
GET {{baseUrl}}/redoc
Accept: text/html

###
# CLEANUP TESTS (if needed)

###
# Final Cleanup: Stop Listening (Optional)
# Uncomment if you want to stop the listener after tests
# POST {{baseUrl}}/stop-listening
# Content-Type: {{contentType}}

###
# Test Summary
# Total Tests: 22 main tests + error handling + interactive tests
# Coverage: Send SMS, Receive SMS, Status, Listening Control, Error Handling
# 
# Expected Results:
# - All GET /status should return connected: true
# - All valid POST /send should return success: true  
# - GET /messages should return array of received messages
# - Error tests should return appropriate HTTP error codes
# - Interactive tests require manual SMS sending
#
# Note: Replace phone numbers with actual test numbers
# Ensure SIM800L module is connected and API is running
